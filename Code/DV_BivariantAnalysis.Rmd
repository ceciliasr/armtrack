---
title: "Bivariant Analysis"
output:
  html_document: default
  pdf_document: default
---

```{r, warning=FALSE, message=FALSE,eval=T, echo=F,results="hide"}
#Installing package
install.packages("c:/TFM/Code/armtrack_0.0.0.9000.tar.gz", repos = NULL, type = "source")
library(armtrack)

if (!require("ggplot2"))
  {
  install.packages("ggplot2")
  library(ggplot2)
}
if (!require("gridExtra"))
{
  install.packages("gridExtra")
  library(gridExtra)
}
if (!require("grid"))
{
  install.packages("grid")
  library(grid)
}
if (!require("plotly"))
{
  install.packages("plotly")
  library(plotly)
}
get_legend<-function(myggplot){
  tmp <- ggplot_gtable(ggplot_build(myggplot))
  leg <- which(sapply(tmp$grobs, function(x) x$name) == "guide-box")
  legend <- tmp$grobs[[leg]]
  return(legend)
}
load("c:/TFM/Data/HeathyD.rda")
load("c:/TFM/Data/BDistrophyD.rda")
load("c:/TFM/Data/TotalD.rda")
```

The next step is to see if there is a relationship between any of the variables. We have plotted the *correlation* between all the variables. First on Becker muscular distrophy data and then in healthy data:

```{r,echo=F, warning=F, message=F, fig.width = 9, fig.height = 9}
  if (!require("corrplot"))
    {
      install.packages("corrplot")
      library(corrplot)
  }
#Balls plot:
mat<-cor(as.matrix(BMD[,1:ncol(BMD)-1]))
diag(mat)<-0
corrplot(mat[2:nrow(mat),2:ncol(mat)],method="circle",is.corr=FALSE,tl.cex=0.7,main="BMDistrophy",mar=c(0,0,1,0))
```

Note that the diagonal is 0. We did this change in order to see better the real correlation between all variables (otherwise, the diagonal is 1 and the other 'balls' could be shorter).

We can see in general a small correlation in all the variables. The positive correlation between elbow position and the upper-forearm angle (in both sides) could be stand out.

Next, we are going to see how are correlated the variables with the 4 highest correlation values:
```{r,echo=F, warning=F, message=F, fig.width = 9, fig.height = 9}
se<-seq(0,nrow(BMD),150)
BMD2<-BMD[rownames(BMD) %in% se,]

mat<-cor(as.matrix(BMD[,1:ncol(BMD)-1]))
mat[which(mat==1)]<-0
var1<-rownames(which(mat == max(abs(mat)), arr.ind = TRUE))[1]
var2<-rownames(which(mat == max(abs(mat)), arr.ind = TRUE))[2]
mat[which(mat==max(abs(mat)))]<-0

p1<-BMD2 %>%
  ggplot(aes(BMD2[[var1]], BMD2[[var2]])) +
  geom_point() +
  theme_minimal()+
  scale_x_continuous(name=paste(var1))+ scale_y_continuous(name=paste(var2))

var3<-rownames(which(mat == max(abs(mat)), arr.ind = TRUE))[1]
var4<-rownames(which(mat == max(abs(mat)), arr.ind = TRUE))[2]
mat[which(mat==max(abs(mat)))]<-0

p2<-BMD2 %>%
  ggplot(aes(BMD2[[var3]], BMD2[[var4]])) +
  geom_point() +
  theme_minimal()+
  scale_x_continuous(name=paste(var3))+ scale_y_continuous(name=paste(var4))

var5<-rownames(which(mat == max(abs(mat)), arr.ind = TRUE))[1]
var6<-rownames(which(mat == max(abs(mat)), arr.ind = TRUE))[2]
mat[which(mat==max(abs(mat)))]<-0

p3<-BMD2 %>%
  ggplot(aes(BMD2[[var5]], BMD2[[var6]])) +
  geom_point() +
  theme_minimal()+
  scale_x_continuous(name=paste(var5))+ scale_y_continuous(name=paste(var6))

var7<-rownames(which(mat == max(abs(mat)), arr.ind = TRUE))[1]
var8<-rownames(which(mat == max(abs(mat)), arr.ind = TRUE))[2]
mat[which(mat==max(abs(mat)))]<-0

p4<-BMD2 %>%
  ggplot(aes(BMD2[[var7]], BMD2[[var8]])) +
  geom_point() +
  theme_minimal()+
  scale_x_continuous(name=paste(var7))+ scale_y_continuous(name=paste(var8))+
  labs(title="Highest correlated variables in Unhealthy Data")


grid.arrange(p1, p2,p3,p4, nrow=2, 
             top = textGrob("Highest correlated variables in Unhealthy Data",gp=gpar(fontsize=20,font=1)))

rm(var1,var2,var3,var4,var5,var6,var7,var8)
```

The first two plots, show us the (obvious) relation between the z axis of the elbow position vector and the upper arm and body angle because the angle has been obtained using the position vector.

On the third plot, we can view the relation between the y axis of the elbow position vector and the upper arm and body angle but here we can not see the relation as clear as before.

Finally, on the last plot, we could see a linear relation in the sense that when the LElbPos_2 value increases, the LHandPos_4 value increases too.

Let's see correlations on the healthy data:

```{r,echo=F, warning=F, message=F, fig.width = 9, fig.height = 9}
mat<-cor(as.matrix(HD[,1:ncol(HD)-1]))
diag(mat)<-0
corrplot(mat[2:nrow(mat),2:ncol(mat)],method="circle",is.corr=FALSE,tl.cex=0.7, main="Healthy",mar=c(0,0,1,0))
```

The main difference we can observe between BMD data and healthy data is that in healthy data there is a bigger correlation in (almost) all the variables. Now we plot the correlation of the 4 highest correlated variables as before:

```{r,echo=F, warning=F, message=F, fig.width = 9, fig.height = 9}
se<-seq(0,nrow(HD),150)
HD2<-HD[rownames(HD) %in% se,]

mat<-cor(as.matrix(HD[,1:ncol(HD)-1]))
mat[which(mat==1)]<-0
var1<-rownames(which(mat == max(abs(mat)), arr.ind = TRUE))[1]
var2<-rownames(which(mat == max(abs(mat)), arr.ind = TRUE))[2]
mat[which(mat==max(abs(mat)))]<-0

p1<-HD2 %>%
  ggplot(aes(HD2[[var1]], HD2[[var2]])) +
  geom_point() +
  theme_minimal()+
  scale_x_continuous(name=paste(var1))+ scale_y_continuous(name=paste(var2))

var3<-rownames(which(mat == max(abs(mat)), arr.ind = TRUE))[1]
var4<-rownames(which(mat == max(abs(mat)), arr.ind = TRUE))[2]
mat[which(mat==max(abs(mat)))]<-0

p2<-HD2 %>%
  ggplot(aes(HD2[[var3]], HD2[[var4]])) +
  geom_point() +
  theme_minimal()+
  scale_x_continuous(name=paste(var3))+ scale_y_continuous(name=paste(var4))

var5<-rownames(which(mat == max(abs(mat)), arr.ind = TRUE))[1]
var6<-rownames(which(mat == max(abs(mat)), arr.ind = TRUE))[2]
mat[which(mat==max(abs(mat)))]<-0

p3<-HD2 %>%
  ggplot(aes(HD2[[var5]], HD2[[var6]])) +
  geom_point() +
  theme_minimal()+
  scale_x_continuous(name=paste(var5))+ scale_y_continuous(name=paste(var6))

var7<-rownames(which(mat == max(abs(mat)), arr.ind = TRUE))[1]
var8<-rownames(which(mat == max(abs(mat)), arr.ind = TRUE))[2]
mat[which(mat==max(abs(mat)))]<-0

p4<-HD2 %>%
  ggplot(aes(HD2[[var7]], HD2[[var8]])) +
  geom_point() +
  theme_minimal()+
  scale_x_continuous(name=paste(var7))+ scale_y_continuous(name=paste(var8))+
  labs(title="Highest correlated variables in Unhealthy Data")


grid.arrange(p1, p2,p3,p4, nrow=2, 
             top = textGrob("Highest correlated variables in Unhealthy Data",gp=gpar(fontsize=20,font=1)))

rm(var1,var2,var3,var4,var5,var6,var7,var8)
```

The comments here are very similar as the ones before, but in order to perform a deeper analysis, as the most correlated variables are exactly the same in both types of data, we are going to perform the same plots including the points of healthy data and the unhealthy one. So, we will be able to see if there exists a difference between both data or not:

```{r,echo=F, warning=F, message=F, fig.width = 9, fig.height = 9}
se<-seq(0,nrow(TD),150)
TD2<-TD[rownames(TD) %in% se,]

mat<-cor(as.matrix(HD[,1:ncol(HD)-1]))
mat[which(mat==1)]<-0
var1<-rownames(which(mat == max(abs(mat)), arr.ind = TRUE))[1]
var2<-rownames(which(mat == max(abs(mat)), arr.ind = TRUE))[2]
mat[which(mat==max(abs(mat)))]<-0

p1<-TD2 %>%
  ggplot(aes(TD2[[var1]], TD2[[var2]],color = Type)) +
  geom_point() +
  theme_minimal()+
  scale_x_continuous(name=paste(var1))+ scale_y_continuous(name=paste(var2))+
  labs(title="Highest correlated variables in Total Data")+theme(legend.position = "none")+ theme(axis.title.x = element_text(vjust=0.5))
p1 <- plotly_build(p1)

p1$x$data[[1]]$text <- paste(var1,":", round(TD2[[var1]],3),
                      '<br> ',var2,":", round(TD2[[var2]],3))

var1<-rownames(which(mat == max(abs(mat)), arr.ind = TRUE))[1]
var2<-rownames(which(mat == max(abs(mat)), arr.ind = TRUE))[2]
mat[which(mat==max(abs(mat)))]<-0

p2<-TD2 %>%
  ggplot(aes(TD2[[var1]], TD2[[var2]],color = Type)) +
  geom_point() +
  theme_minimal()+
  scale_x_continuous(name=paste(var1))+ scale_y_continuous(name=paste(var2))+
  labs(title="Highest correlated variables in Total Data")+theme(legend.position = "none")+ theme(axis.title.x = element_text(vjust=0.5))
p2 <- plotly_build(p2)

p2$x$data[[1]]$text <- paste(var1,":", round(TD2[[var1]],3),
                      '<br> ',var2,":", round(TD2[[var2]],3))


var1<-rownames(which(mat == max(abs(mat)), arr.ind = TRUE))[1]
var2<-rownames(which(mat == max(abs(mat)), arr.ind = TRUE))[2]
mat[which(mat==max(abs(mat)))]<-0

p3<-TD2 %>%
  ggplot(aes(TD2[[var1]], TD2[[var2]],color = Type)) +
  geom_point() +
  theme_minimal()+
  scale_x_continuous(name=paste(var1))+ scale_y_continuous(name=paste(var2))+
  labs(title="Highest correlated variables in Total Data")+theme(legend.position = "none")
p3 <- plotly_build(p3)

p3$x$data[[1]]$text <- paste(var1,":", round(TD2[[var1]],3),
                      '<br> ',var2,":", round(TD2[[var2]],3))


var1<-rownames(which(mat == max(abs(mat)), arr.ind = TRUE))[1]
var2<-rownames(which(mat == max(abs(mat)), arr.ind = TRUE))[2]
mat[which(mat==max(abs(mat)))]<-0

p4<-TD2 %>%
  ggplot(aes(TD2[[var1]], TD2[[var2]],color = Type)) +
  geom_point() +
  theme_minimal()+
  scale_x_continuous(name=paste(var1))+ scale_y_continuous(name=paste(var2))+
  labs(title="Highest correlated variables in Total Data")+theme(legend.position = "none")
p4 <- plotly_build(p4)

p4$x$data[[1]]$text <- paste(var1,":", round(TD2[[var1]],3),
                      '<br> ',var2,":", round(TD2[[var2]],3))

p <- subplot(p1, p2,p3,p4,nrows=2,titleX=T, titleY=T,margin=0.07)
p
```
