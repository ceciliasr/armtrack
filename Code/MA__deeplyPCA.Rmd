---
title: "PCA components"
output: html_document
---

```{r,message=F, echo=F, eval=T,warning=F,results="hide"}
if (!require("matrixStats"))
{
  install.packages("matrixStats")
  library(matrixStats)
}
load("c:/TFM/Data/BDistrophyD.rda")
load("c:/TFM/Data/HealthyD.rda")
```

#INTRODUCTION#
Along this document, we are going to achieve a better knowledge about the first principal components. We will start explaining the method used with BMDistrophy data and we will apply the same procedures for the Healthy data.

#PROCEDURE#

The main idea of this document is to understand which is the relationship between each initial variable and the first principal components. In order to do this, we will reconstruct the initial database (scaled) from PCA outputs and vice versa: construct first PC components with eigenvectors and variable values (from the initial database).

With the purpose of reconstructing the initial scaled database from PCA outputs, we have followed the steps:

1) Compute PCA with prcomp function


```{r}
#Timestamp and data type are not relevant variables for PCA
x<-as.matrix(subset(BMD,select=-c(Timestamp,Type)))
#Performing PCA
pca<-prcomp(x,center=T,scale=T)
```

2) Save the relevant results: 

2.1. eigenvectors: relation between PCs and database variables

2.2. $\mu$: database constructed with the variable means

2.3. indiv_components: value of PCs for each individual (in our data, individual=timestamp mark)

```{r}
eigenvectors<-as.matrix(pca$rotation)
mu<-unname(pca$center)
mu<-matrix(mu,nrow=nrow(x),ncol=ncol(x),byrow=TRUE)
indiv_components<-as.matrix(pca$x)
```

3. In order to reconstruct the initial values, we should follow the formula:
$$
Var=PC_{scores}â‹…Eigenvectors
$$
```{r}
res<-indiv_components%*%t(eigenvectors)
```

4. The 3rd step would rebuild the initial database if we had not centered nor scaled the initial database.

In order to 'correct' the center step, we must add the $\mu$ matrix:

```{r}
res_cent<-res+mu
```

5. Check: The previous database is the initial one but scaled, we can check the first 5 variables:

```{r}
res_sca<-scale(res_cent)
x_sca<-scale(x)
head(res_sca[,1:5])
head(x_sca[,1:5])
```

We can observe the same results on the initial scaled database and on the computed one.

With the purpose of reconstructing the PC with the eigenvectors and initial database, we should perform the previous 1 and 2 steps and then:

3. For the first principal component, we should multiply the scale values of the initial database by the first column of eigenvectors:

```{r}
#Reconstructing first PCA component:
pc1<-scale(x)%*%eigenvectors[,1]
```

4. Checking:
```{r}
head(pc1)
head(indiv_components[,1])
```

We can observe the same results on the R output and on the computed one.

#BMDISTROPHY DATA#

Now, we are going to apply the second procedure (from initial database and eigenvectors to PC components) to the BMDistrophy Data in order to reconstruct the first principal components. As we have seen on previous documents, the first 6 components explain more than a 90\% of data variability so we will focus our efforts on reconstructing this 6 PC:

```{r}
pc1_6<-scale(x)%*%eigenvectors[,1:6]
head(pc1_6)
```

If we look at the plot made on previous documents about the variables contribution to the first principal component:

![PC1: variables contribution](images/BMD_pc1_cont.PNG)

The idea now is to 'play' with the values of the first 10 variables of the plot (the ones that contribute in more than a 6\% of the PC1 variability) in order to see how the PC1 values vary. We are going to do this study by couples of variables as follows:

1) RhandPos_4 and LhandPos_4 (19.8\% total contrib.)

2) RElbPos_2 and LElbPos_2 (18.7\% total contrib.)

3) RSAngle and LSAngle (18.5\% total contrib.)

4) RElbPos_4 and LElbPos_4 (14.5\% total contrib.)

5) RhandPos_2 and LhandPos_2 (14.4\% total contrib.)


